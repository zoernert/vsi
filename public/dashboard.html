<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VSI Vector Store - Dashboard</title>
    <link rel="stylesheet" href="fiori-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Top Navigation Bar -->
    <header class="fiori-header">
        <div class="header-left">
            <button class="menu-toggle" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
            <h1 class="app-title">VSI Vector Store</h1>
        </div>
        
        <div class="header-center">
            <div class="global-search">
                <input type="text" id="global-search-input" placeholder="Search across all collections...">
                <button onclick="performGlobalSearch()">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>
        
        <div class="header-right">
            <div class="user-profile-dropdown">
                <button class="user-profile-btn" onclick="toggleUserMenu()">
                    <i class="fas fa-user-circle"></i>
                    <span id="username-display"></span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="user-dropdown-menu" id="user-dropdown">
                    <div class="user-menu-item" onclick="showBearerToken()">
                        <i class="fas fa-key"></i> Bearer Token
                    </div>
                    <div class="user-menu-item" onclick="showUsagePlan()">
                        <i class="fas fa-chart-bar"></i> Usage & Plan
                    </div>
                    <div class="user-menu-item" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="app-container">
        <!-- Left Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="context-help-card">
                <div class="card-header">
                    <h3><i class="fas fa-lightbulb"></i> Context Help</h3>
                </div>
                <div class="context-content" id="context-help-content">
                    <div class="help-section">
                        <h4>Getting Started</h4>
                        <p>Welcome to VSI Vector Store! Start by creating a collection and uploading your first document.</p>
                        <div class="api-example">
                            <strong>API Equivalent:</strong>
                            <code>curl -X PUT "${baseUrl}/collections/my-docs" -H "Authorization: Bearer ${token}"</code>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Global Search Results -->
            <div class="fiori-card search-results-card" id="global-search-results" style="display: none;">
                <div class="card-header">
                    <h3><i class="fas fa-search"></i> Search Results</h3>
                    <button class="card-action" onclick="hideGlobalSearch()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="card-content" id="global-search-content">
                    <!-- Search results will be displayed here -->
                </div>
            </div>

            <!-- Cards Grid -->
            <div class="cards-grid">
                <!-- Collections Management Card -->
                <div class="fiori-card" data-card="collections">
                    <div class="card-header">
                        <h3><i class="fas fa-folder"></i> Collections</h3>
                        <div class="card-actions">
                            <button class="card-action" onclick="toggleCardSize('collections')">
                                <i class="fas fa-expand"></i>
                            </button>
                            <button class="card-action" onclick="minimizeCard('collections')">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="action-toolbar">
                            <input type="text" id="new-collection-name" placeholder="Collection name" class="fiori-input">
                            <button onclick="createCollection()" class="fiori-btn primary">
                                <i class="fas fa-plus"></i> Create
                            </button>
                            <button onclick="loadCollections()" class="fiori-btn secondary">
                                <i class="fas fa-refresh"></i> Refresh
                            </button>
                        </div>
                        <div id="collections-list" class="collections-grid"></div>
                    </div>
                </div>

                <!-- File Upload Card -->
                <div class="fiori-card" data-card="upload">
                    <div class="card-header">
                        <h3><i class="fas fa-cloud-upload-alt"></i> Upload Files</h3>
                        <div class="card-actions">
                            <button class="card-action" onclick="toggleCardSize('upload')">
                                <i class="fas fa-expand"></i>
                            </button>
                            <button class="card-action" onclick="minimizeCard('upload')">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="upload-area">
                            <select id="upload-collection" class="fiori-select">
                                <option value="">Select collection...</option>
                            </select>
                            
                            <!-- Upload Tabs -->
                            <div class="upload-tabs">
                                <button class="upload-tab-btn active" onclick="switchUploadTab('files')">
                                    <i class="fas fa-file"></i> Files
                                </button>
                                <button class="upload-tab-btn" onclick="switchUploadTab('url')">
                                    <i class="fas fa-link"></i> URL
                                </button>
                            </div>
                            
                            <!-- File Upload Tab -->
                            <div class="upload-tab-content" id="upload-tab-files">
                                <div class="file-drop-zone" ondrop="handleFileDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Drop files here or click to browse</p>
                                    <input type="file" id="file-input" multiple 
                                           accept=".txt,.md,.pdf,.docx,.doc,.xlsx,.xls,.jpg,.jpeg,.png,.gif,.bmp,.webp"
                                           onchange="handleFileSelection(event)">
                                </div>
                                
                                <!-- Selected Files Display -->
                                <div id="selected-files-display" class="selected-files" style="display: none;">
                                    <h4><i class="fas fa-check-circle"></i> Selected Files:</h4>
                                    <div id="selected-files-list"></div>
                                    <div class="file-actions">
                                        <button onclick="clearSelectedFiles()" class="fiori-btn secondary">
                                            <i class="fas fa-times"></i> Clear
                                        </button>
                                        <button onclick="uploadFiles()" class="fiori-btn primary">
                                            <i class="fas fa-upload"></i> Upload & Index
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- URL Upload Tab -->
                            <div class="upload-tab-content" id="upload-tab-url" style="display: none;">
                                <div class="url-upload-area">
                                    <label class="fiori-label">Enter URL to download:</label>
                                    <input type="url" id="url-input" placeholder="https://example.com/document.pdf" class="fiori-input">
                                    <label class="fiori-label">Custom filename (optional):</label>
                                    <input type="text" id="url-filename" placeholder="document.pdf" class="fiori-input">
                                    <button onclick="uploadFromUrl()" class="fiori-btn primary">
                                        <i class="fas fa-download"></i> Download & Index
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div id="upload-progress"></div>
                    </div>
                </div>

                <!-- LLM Q&A Card -->
                <div class="fiori-card" data-card="qa">
                    <div class="card-header">
                        <h3><i class="fas fa-robot"></i> AI Assistant</h3>
                        <div class="card-actions">
                            <button class="card-action" onclick="toggleCardSize('qa')">
                                <i class="fas fa-expand"></i>
                            </button>
                            <button class="card-action" onclick="minimizeCard('qa')">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="qa-form">
                            <select id="qa-collection-select" class="fiori-select">
                                <option value="">Select collection...</option>
                            </select>
                            <textarea id="qa-question" placeholder="Ask a question about your documents..." 
                                      class="fiori-textarea" rows="3"></textarea>
                            <div class="advanced-options" style="display: none;">
                                <textarea id="qa-system-prompt" placeholder="Custom system prompt (optional)..." 
                                          class="fiori-textarea" rows="2"></textarea>
                                <input type="number" id="qa-max-results" value="5" min="1" max="20" class="fiori-input small">
                            </div>
                            <div class="qa-actions">
                                <button onclick="askQuestion()" class="fiori-btn primary">
                                    <i class="fas fa-paper-plane"></i> Ask Question
                                </button>
                                <button onclick="toggleAdvancedOptions()" class="fiori-btn secondary">
                                    <i class="fas fa-cog"></i> Advanced
                                </button>
                            </div>
                        </div>
                        <div id="qa-results" class="qa-results-area"></div>
                    </div>
                </div>

                <!-- Document Browser Card -->
                <div class="fiori-card" data-card="browser">
                    <div class="card-header">
                        <h3><i class="fas fa-file-alt"></i> Document Browser</h3>
                        <div class="card-actions">
                            <button class="card-action" onclick="toggleCardSize('browser')">
                                <i class="fas fa-expand"></i>
                            </button>
                            <button class="card-action" onclick="minimizeCard('browser')">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="browser-toolbar">
                            <select id="browse-collection" class="fiori-select">
                                <option value="">Select collection...</option>
                            </select>
                            <button onclick="browseDocuments()" class="fiori-btn primary">
                                <i class="fas fa-search"></i> Browse
                            </button>
                        </div>
                        <div id="browse-results" class="document-list"></div>
                    </div>
                </div>

                <!-- Text Creation Card -->
                <div class="fiori-card" data-card="text-creation">
                    <div class="card-header">
                        <h3><i class="fas fa-edit"></i> Create Document</h3>
                        <div class="card-actions">
                            <button class="card-action" onclick="toggleCardSize('text-creation')">
                                <i class="fas fa-expand"></i>
                            </button>
                            <button class="card-action" onclick="minimizeCard('text-creation')">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-content">
                        <select id="text-collection" class="fiori-select">
                            <option value="">Select collection...</option>
                        </select>
                        <input type="text" id="text-title" placeholder="Document title" class="fiori-input">
                        <textarea id="text-content" placeholder="Enter your text content here..." 
                                  class="fiori-textarea" rows="6"></textarea>
                        <button onclick="createTextDocument()" class="fiori-btn primary">
                            <i class="fas fa-save"></i> Create & Index
                        </button>
                    </div>
                </div>

                <!-- Usage & Analytics Card -->
                <div class="fiori-card" data-card="usage" style="display: none;">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-bar"></i> Usage & Plan</h3>
                        <div class="card-actions">
                            <button class="card-action" onclick="toggleCardSize('usage')">
                                <i class="fas fa-expand"></i>
                            </button>
                            <button class="card-action" onclick="minimizeCard('usage')">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-content">
                        <div id="usage-stats">Loading usage statistics...</div>
                    </div>
                </div>

                <!-- Admin Panel Card (shown only for admins) -->
                <div class="fiori-card admin-card" data-card="admin" id="admin-panel" style="display: none;">
                    <div class="card-header">
                        <h3><i class="fas fa-user-shield"></i> Admin Panel</h3>
                        <div class="card-actions">
                            <button class="card-action" onclick="toggleCardSize('admin')">
                                <i class="fas fa-expand"></i>
                            </button>
                            <button class="card-action" onclick="minimizeCard('admin')">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-content">
                        <!-- Admin Dashboard Link -->
                        <div style="margin-bottom: 24px; padding: 16px; background: var(--fiori-bg-secondary); border-radius: 8px; border: 1px solid var(--fiori-border);">
                            <h4 style="margin: 0 0 12px 0; color: var(--fiori-text-primary); display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-tachometer-alt"></i>
                                Full Admin Dashboard
                            </h4>
                            <p style="margin: 0 0 16px 0; color: var(--fiori-text-secondary); font-size: 14px;">
                                Access the complete admin dashboard with advanced analytics, user management, and system monitoring.
                            </p>
                            <a href="/admin/dashboard.html" class="fiori-btn primary" style="text-decoration: none;">
                                <i class="fas fa-external-link-alt"></i>
                                Open Admin Dashboard
                            </a>
                        </div>
                        
                        <div class="admin-tabs">
                            <button class="tab-btn active" onclick="showAdminTab('users')">Users</button>
                            <button class="tab-btn" onclick="showAdminTab('system')">System</button>
                        </div>
                        
                        <div class="admin-tab-content" id="admin-users-tab">
                            <div class="admin-section">
                                <h4>Create User</h4>
                                <div class="form-row">
                                    <input type="text" id="admin-new-username" placeholder="Username" class="fiori-input">
                                    <input type="password" id="admin-new-password" placeholder="Password" class="fiori-input">
                                </div>
                                <label class="fiori-checkbox">
                                    <input type="checkbox" id="admin-new-isadmin">
                                    <span class="checkmark"></span>
                                    Admin User
                                </label>
                                <button onclick="createUser()" class="fiori-btn primary">
                                    <i class="fas fa-user-plus"></i> Create User
                                </button>
                            </div>
                            <div id="users-list" class="users-table"></div>
                        </div>
                        
                        <div class="admin-tab-content" id="admin-system-tab" style="display: none;">
                            <div class="system-status-grid">
                                <div class="status-item">
                                    <label>Self Registration:</label>
                                    <span id="self-reg-status" class="status-badge">-</span>
                                </div>
                                <div class="status-item">
                                    <label>RapidAPI Support:</label>
                                    <span id="rapidapi-status" class="status-badge">-</span>
                                </div>
                                <div class="status-item">
                                    <label>MCP Service:</label>
                                    <span id="mcp-status" class="status-badge">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div class="modal" id="bearer-token-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-key"></i> Bearer Token</h3>
                <button class="modal-close" onclick="closeModal('bearer-token-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <label>Your API Bearer Token:</label>
                <div class="token-display">
                    <input type="text" id="api-key" readonly class="fiori-input">
                    <button onclick="copyApiKey()" class="fiori-btn secondary">
                        <i class="fas fa-copy"></i> Copy
                    </button>
                </div>
                <div class="api-examples">
                    <h4>Usage Examples:</h4>
                    <pre><code id="token-examples">curl -H "Authorization: Bearer YOUR_TOKEN" ${baseUrl}/collections</code></pre>
                </div>
            </div>
        </div>
    </div>

    <script src="dashboard.js"></script>
    <script src="fiori-dashboard.js"></script>
</body>
</html>
